#!/bin/sh
if [ "${FMLD_DATASTORE_POSTGRES_DB}" ]; then
    psql -U postgres -c "CREATE USER ${FMLD_DATASTORE_POSTGRES_READ_USER} \
        WITH PASSWORD '${FMLD_DATASTORE_POSTGRES_READ_PWD}' \
        NOSUPERUSER NOCREATEDB NOCREATEROLE;"

    if [ "${FMLD_DATASTORE_POSTGRES_WRITE_USER}" ] && [ "${FMLD_DATASTORE_POSTGRES_WRITE_PWD}"  ]; then
        psql -U postgres -c "CREATE USER ${FMLD_DATASTORE_POSTGRES_WRITE_USER} \
            WITH PASSWORD '${FMLD_DATASTORE_POSTGRES_WRITE_PWD}' \
            NOSUPERUSER NOCREATEDB NOCREATEROLE;"
    fi

    createdb -U postgres -e -O ${FMLD_DATASTORE_POSTGRES_WRITE_USER} ${FMLD_DATASTORE_POSTGRES_DB} -E utf-8
fi
